@page
@model IndexModel
@using CloudDrive
@using CloudDrive.Areas.Identity.Pages.Account.Manage
@using Microsoft.AspNetCore.Mvc.Localization

@inject IHtmlLocalizer<SharedResource> Localizer

@{
	ViewData["Title"] = "Profile";
	ViewData["ActivePage"] = ManageNavPages.Index;
}

<partial name="_StatusMessage" model="Model.StatusMessage" />

<form id="profile-form" method="post" enctype="multipart/form-data">

	<div class="mb-10">
		<div onclick="document.getElementById('Input_LogoFile').click()"
			class="rounded-full overflow-hidden relative mx-auto h-48 w-48 bg-gray-300 bg-opacity-70 cursor-pointer">

			@if (!string.IsNullOrEmpty(@Model.Input.Logo))
			{
				<img class="rounded-full h-full w-full z-10 absolute top-0 left-0 right-0 bottom-0"
					id="Input_LogoFilePreview" alt="Profile" src="/api/Logos/@Model.UserId" />
			}
			else
			{
				<span id="profileTag"
					class="text-center h-full w-full text-2xl text-gray-600 absolute top-0 left-0 right-0 bottom-0 flex justify-center items-center ">
					PROFILE
				</span>
				<img class="rounded-full h-full w-full hidden z-10 absolute top-0 left-0 right-0 bottom-0"
					id="Input_LogoFilePreview" alt="Profile" />
			}

		</div>

		<input asp-for="Input.LogoFile" class="hidden" accept="image/*" />
		<span asp-validation-for="Input.Logo" class="text-danger"></span>
	</div>

	<div asp-validation-summary="ModelOnly" class="text-danger mb-4"></div>

	<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
		<div class="form-group">
			<label asp-for="Username"></label>
			<input asp-for="Username" class=" form-control bg-primary-200" disabled />
		</div>

		<div class="form-group">
			<label asp-for="Input.PhoneNumber"></label>
			<input asp-for="Input.PhoneNumber" class=" form-control bg-primary-200" />
			<span asp-validation-for="Input.PhoneNumber" class="text-danger"></span>
		</div>
	</div>

	<button id="update-profile-button" type="submit" class="transition-all duration-200 bg-primary-blue
		 hover:bg-primary-blue rounded-md px-10 py-2 text-white">
		@Localizer["Save"]
	</button>
</form>

@section Scripts {

	<script>
		const onLogoFileUpload = (elementId) => {
			return (e) => {
				let targetImage = document.getElementById(`${elementId}Preview`);
				let logoInput = document.getElementById(elementId);
				let profileTag = document.getElementById('profileTag');

				if (profileTag) {
				}
				const [file] = logoInput.files

				if (file) {
					targetImage.src = URL.createObjectURL(file);
					targetImage.classList.remove('hidden');
					profileTag.classList.add('hidden');
				} else {
					targetImage.classList.add('hidden');
					profileTag.classList.remove('hidden');
				}
			};
		};

		document.onreadystatechange = (e) => {
			if (e.target.readyState === "interactive") {
				let inputLogoFile = document.getElementById('Input_LogoFile');

				if (inputLogoFile) {
					inputLogoFile.onchange = onLogoFileUpload('Input_LogoFile');


				}
			}
		}
	</script>
	<partial name="_ValidationScriptsPartial" />
}